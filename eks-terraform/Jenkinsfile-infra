pipeline {
    agent any

    options {
        timestamps()
        disableConcurrentBuilds()
    }

    stages {

        stage('Checkout') {
            steps {
                echo "ğŸ“¥ Checking out code..."
                checkout scm
            }
        }

        stage('Terraform Init') {
            steps {
                echo "ğŸš€ Terraform init..."
                sh "terraform init"
            }
        }

        stage('Terraform Validate') {
            steps {
                echo "ğŸ§ª Terraform validate..."
                sh "terraform validate"
            }
        }

        stage('Terraform Plan') {
            steps {
                echo "ğŸ“Š Terraform plan..."
                sh "terraform plan -out=tfplan"
            }
        }

        stage('Terraform Apply') {
            steps {
                echo "âš¡ Terraform apply..."
                sh "terraform apply -auto-approve tfplan"
            }
        }

    }

    post {
        success { echo "ğŸ‰ Terraform Infrastructure Deployment Completed Successfully!" }
        failure { echo "âŒ Terraform Deployment Failed!" }
    }
}
