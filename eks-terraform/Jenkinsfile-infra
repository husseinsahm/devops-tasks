pipeline {
    agent any

    options {
        timestamps()
        disableConcurrentBuilds()
    }

    stages {

        stage('Checkout') {
            steps {
                echo "ğŸ“¥ Checking out code..."
                checkout scm
            }
        }

        stage('Terraform Init') {
            steps {
                echo "ğŸš€ Terraform init..."
                sh """
                    cd eks-terraform
                    terraform init
                """
            }
        }

        stage('Terraform Validate') {
            steps {
                echo "ğŸ§ª Terraform validate..."
                sh """
                    cd eks-terraform
                    terraform validate
                """
            }
        }

        stage('Terraform Plan') {
            steps {
                echo "ğŸ“Š Terraform plan..."
                sh """
                    cd eks-terraform
                    terraform plan -var-file=terraform.tfvars -out=tfplan
                """
            }
        }

        stage('Terraform Apply') {
            steps {
                echo "âš¡ Terraform apply..."
                sh """
                    cd eks-terraform
                    terraform apply -var-file=terraform.tfvars -auto-approve tfplan
                """
            }
        }


    }

    post {
        success { echo "ğŸ‰ Terraform Infrastructure Deployment Completed Successfully!" }
        failure { echo "âŒ Terraform Deployment Failed!" }
    }
}
